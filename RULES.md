# RULES.md
> 이 문서는 AI 에이전트가 코드를 생성하거나 수정할 때 반드시 지켜야 할 불변 규칙이다.
> 위배될 경우 PLAN → CONFLICTS 섹션에서 반드시 명시하고, 승인 없이 변경하지 않는다.

---

## 1. 프로젝트 원칙 (Principles)
- 코드 변경 시 **PLAN → APPROVAL → APPLY** 순서를 따른다.
- 한 번에 작은 단위로 수정하고, **실행 결과를 예측가능하게 유지**한다.
- 기존 의도 문서(INTENT.md)와 어긋나는 로직을 만들어서는 안 된다.
- 테스트 가능한 코드만 생성한다. 테스트가 불가하면 설계를 조정한다.

---

## 2. 기술 규칙 (Tech Constraints)
- 언어: **TypeScript**
- 런타임: **Node.js 20+**
- 스타일: **ESLint + Prettier 규칙 준수**
- 패턴: `서비스-layer`, `DTO`, `도메인-layer` 분리
- 금지:
  - `any` 남발
  - 사이드 이펙트가 큰 글로벌 상태
  - 매직 넘버/매직 스트링
  - 비동기 호출에서 `.then().catch()` 체인 (async/await만 사용)

---

## 3. 문서 & 테스트 규칙
- 새로운 기능은 항상 **테스트 케이스 1개 이상** 동반
- API 변경 시 반드시 **CHANGELOG 업데이트**
- PR 설명에는 **의도와 검증 방법**을 함께 남긴다

### 3.1. 코드 문서화 규칙 (Code Documentation)
모든 새로운 파일/모듈은 **반드시 다음 내용을 포함한 한글 주석**을 작성해야 한다:

```python
"""
[모듈명] - [간단한 설명]

이 모듈의 목적:
- 파일이 왜 존재하는지
- 무엇을 하는지
- 어떤 문제를 해결하는지

주요 기능:
- 제공하는 핵심 기능 1
- 제공하는 핵심 기능 2
- 제공하는 핵심 기능 3

구현 사항:
- 사용된 알고리즘 또는 디자인 패턴
- 주요 기술적 결정 사항
- 성능 고려사항 (있는 경우)

TASK 참조:
- TASK-XXX: 구현한 태스크 명시

사용 예시:
    from module import SomeClass

    instance = SomeClass()
    result = instance.do_something()
"""
```

**필수 포함 사항:**
1. **모듈의 목적**: 파일이 왜 존재하는지, 무엇을 하는지
2. **주요 기능**: 제공하는 핵심 기능들 (최소 2-3개)
3. **구현 사항**: 어떻게 구현되었는지 (알고리즘, 패턴 등)
4. **TASK 참조**: 어떤 TASK를 구현했는지
5. **사용 예시**: 실제로 어떻게 사용하는지 (코드 포함)

**클래스/함수 문서화:**
```python
class MyClass:
    """
    클래스 설명 (한 줄 요약)

    더 자세한 설명 (필요시)
    주요 책임과 역할을 명시
    """

    def my_method(self, param1: str, param2: int) -> bool:
        """
        메서드 설명 (한 줄 요약)

        Args:
            param1: 파라미터 설명
            param2: 파라미터 설명

        Returns:
            반환값 설명

        Raises:
            ValueError: 발생 조건 설명
        """
```

---

## 4. 보안 / 품질 규칙
- 외부 입력은 반드시 Validation
- 로깅 시 민감정보 출력 금지
- 네이밍은 사람이 읽기 쉬운 방향을 우선

---

## 5. 위배 시 절차
1) PLAN 결과에 `CONFLICTS:` 섹션 생성
2) 왜 규칙을 위반해야 하는지 설명
3) 승인되기 전까지 APPLY 작업 금지
